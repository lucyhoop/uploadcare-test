<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Uploadcare Display Ad Uploader</title>

  <!-- Uploadcare public API key -->
  <script>
    UPLOADCARE_PUBLIC_KEY = "a51c89007d0bce21876e";
  </script>

  <!-- Uploadcare widget script -->
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
</head>
<body>
  <h1>Upload Display Ad Files</h1>

  <!-- Uploadcare input widget with validation settings -->
  <input
    type="hidden"
    role="uploadcare-uploader"
    data-images-only
    data-multiple
    data-max-size="500000"
    data-clearable
    data-validator="customImageValidator"
  />

  <!-- Custom validator script -->
<script>
  function customImageValidator(fileInfo) {
    return fileInfo.done().then(function(info) {
      return uploadcare.fileFrom('uploaded', info.cdnUrl + '-/info/').then(function(detailedInfo) {
        const { width, height, size, mimeType } = detailedInfo;

        const allowedDimensions = [
          [300, 250],
          [728, 90],
          [300, 600],
          [160, 600],
          [320, 50],
          [320, 480],
          [336, 280],
          [768, 1024],
          [848, 480],
          [1200, 1200],
          [900, 1600]
        ];

        const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
        const maxSize = 500000; // 500 KB

        const exactWidth = Number(width);
        const exactHeight = Number(height);

        console.log(`Image dimensions: ${exactWidth}x${exactHeight}, size: ${size}, type: ${mimeType}`);

        const validType = allowedTypes.includes(mimeType);
        const validSize = size <= maxSize;
        const validDimensions = allowedDimensions.some(
          dim => exactWidth === dim[0] && exactHeight === dim[1]
        );

        if (!validType) {
          throw new Error("❌ File must be JPG, PNG, or GIF.");
        }

        if (!validSize) {
          throw new Error("❌ File must be 500 KB or smaller.");
        }

        if (!validDimensions) {
          throw new Error(`❌ Invalid dimensions: ${exactWidth}x${exactHeight}. Must match approved sizes exactly.`);
        }

        return detailedInfo;
      });
    });
  }
</script>
</body>
</html>
