<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Uploadcare Display Ad Uploader</title>

  <!-- Uploadcare public API key -->
  <script>
    UPLOADCARE_PUBLIC_KEY = "a51c89007d0bce21876e";
  </script>

  <!-- Uploadcare widget script -->
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
</head>
<body>
  <h1>Upload Display Ad Files</h1>

  <!-- Uploadcare widget input -->
  <input
    type="hidden"
    role="uploadcare-uploader"
    name="adUploader"
    id="adUploader"
    data-images-only
    data-multiple
    data-max-size="500000"
    data-clearable
    data-validator="customImageValidator"
  />

  <!-- Custom validator script -->
  <script>
    function customImageValidator(fileInfo) {
      return fileInfo.done().then(function(info) {
        console.log("Validator running for:", info.cdnUrl);
        const allowedDimensions = [
          [300, 250],
          [728, 90],
          [300, 600],
          [160, 600],
          [320, 50],
          [320, 480],
          [336, 280],
          [768, 1024],
          [848, 480],
          [1200, 1200],
          [900, 1600]
        ];

        const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
        const maxSize = 500000;

        const { width, height, size, mimeType } = info;

        const isTypeValid = allowedTypes.includes(mimeType);
        const isSizeValid = size <= maxSize;
        const isDimensionValid = allowedDimensions.some(
          ([w, h]) => width === w && height === h
        );

        if (!isTypeValid) {
          console.error("Invalid file type:", mimeType);
          throw new Error("❌ File must be JPG, PNG, or GIF.");
        }

        if (!isSizeValid) {
          console.error("Invalid file size:", size);
          throw new Error("❌ File must be 500 KB or smaller.");
        }

        if (!isDimensionValid) {
          console.error(`Invalid dimensions: ${width}x${height}`);
          throw new Error(`❌ Invalid dimensions: ${width}x${height}. Must exactly match one of the approved ad sizes.`);
        }

        console.log("✅ File passed validation.");
        return info;
      });
    }

    // Ensure the validator is registered globally
    window.customImageValidator = customImageValidator;
  </script>
</body>
</html>
